---

# The jenkins-utils Travis CI/CD configuration.
language: python

os:
- linux

# Our build stages.
# (`test` is basically a travis default default so we don't need to name it).
# But we do want a `deploy` stage that only runs if the the commit is tagged
# (with a label that begins `pypi-` and it's on the master branch).
# Our tags for PyPI distributions will be of the form `pypi-1.0.1`.
stages:
- name: test
- name: deploy
  if: tag is present

# Run Travis on all branches
# (normally it only runs on master)
branches:
  only:
  - "/.*/"

# Installation steps.
# We have more than one requirements file.
install:
- pip install -r package-requirements.txt
- pip install -r requirements.txt

# Test/build execution steps...
# All in the default 'test' stage.
script:
- pyroma .
- pylint im_jenkins_server.py
- python setup.py bdist_wheel

# Execution jobs.
# Let's run the script against various Python versions
# and then move to our deploy stage. Travis will only run the deploy stage
# when the test stages have passed. Deployment will also only execute
# if this triggering commit is tagged and we're on the master branch.
jobs:
  include:
  - python: 3.6

  - stage: deploy
    python: 3.6
    # No need to re-run scripted commands here.
    # They're all part of the above test stages.
    script: skip
    deploy:
    - provider: pypi
      user: informaticsmatters
      password:
        secure: "j5jlLbAGRa566wp+gg19fN36QRMs8vwigtcblaeupdPFPptXjN65HhVSZ9IiEk+C87kxvSA9vrTELNzqcU1oToeEiO9CVJIE41OHOJgVamGQSiENYY08PemReVW76HfWzmgxHY4MpZ/Wz0unFNMfjfdYqXNz4Ydp7XedSo/S0USb1iD5nwnTeWdUCLeT95dQG0mcC9FAapJd+VGQ1o8xysyGEaNvNNT/eXmqXJSSzvf5D3cW38At1uYjEMSIJXLFZQJHwGvjk2cZv0wouOhDLM4oVSf7G1N9pDUFqZcJYaAFBA5dpkYWlLq+aIWTQxF092IsrrQaX7x7cA9YOl1v1p6+Xk/niUtqLuUXS5J4Q1JqKQMAPs0toh+ZFte4IB/QUE7ft7/3RQInET978CSpb/wrSs7pH0FMbcjYGV34ItVkNvDefcD1PbcNdvWgoNzsFpawI8kJGj2r8do8ziTJnzURfhSbuhICXgnFm/XOlXom6gMU2YbAReSHkvFVpo1bIWke17lvmNzLw7fgwYe5znNgqnQt3/TZ0YKuc4TKbhX/MSC12ZcH62IDJtjTe3drAr855xkepnPJCisW61pmdVPKpJ/bT9PScYCx3CiI5TqmID36aQxDWcSB+WV8jE3xrwAo+nx8kspQPpWNKwGVurSD7zCoK4QUyGTwS/m61R8="
      distributions: bdist_wheel
      on:
        tags: true
        branch: master
        condition: $TRAVIS_TAG =~ ^pypi
